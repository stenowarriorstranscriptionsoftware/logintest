<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8" />
  <title>Steno Warriors Transcription Software</title>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>

  <!-- Local Scripts -->
  <script src="lookup.js"></script>
  <script src="textLookup.js"></script>
  <script src="1c2.js"></script>

  <!-- Styles -->
  <link rel="stylesheet" href="styles.css">
  <link rel="preconnect" href="https://fonts.googleapis.com/">
  <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Exo+2&display=swap" rel="stylesheet">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<body>
  <!-- Login UI -->
  <div id="login-container" class="login-container">
    <div class="login-content">
      <h2>Welcome to Steno Warriors</h2>
      <p>Please sign in with Google to access the transcription tests</p>
      <button id="googleSignIn" class="google-signin-btn">
        <img src="https://upload.wikimedia.org/wikipedia/commons/5/53/Google_%22G%22_Logo.svg" alt="Google logo">
        Sign in with Google
      </button>
    </div>
  </div>

  <!-- Header -->
  <div class="header">
    <h1>Steno Warriors Transcription Software</h1>
    <div id="user-info" style="display: none;">
      <img id="user-photo" width="40" height="40" style="border-radius: 50%; vertical-align: middle;">
      <span id="user-name" style="margin: 0 10px;"></span>
      <button id="signOut" class="sign-out-btn">Sign Out</button>
    </div>
  </div>

  <!-- App Content -->
  <div class="main" id="app-content" style="display: none;">
    <div class="app-tabs">
      <button class="tab-button active" data-tab="test">Take Test</button>
      <button class="tab-button" data-tab="leaderboard">üèÜ Leaderboard</button>
    </div>

    <!-- Test Tab -->
    <div id="test-tab" class="tab-content active">
      <h2>Please select a Test</h2>
      <div class="select-panel">
        <select id="volume-select">
          <option value="1">Test 1-22</option>
          <option value="2">Test 23-44</option>
          <option value="3">Test 45-66</option>
          <option value="4">Test 67-88</option>
          <option value="5">Test 89-110</option>
        </select>

        <select id="test-select"></select>

        <select id="speed-select">
          <option value="70">70 WPM</option>
          <option value="75">75 WPM</option>
          <option value="80">80 WPM</option>
          <option value="85">85 WPM</option>
          <option value="90">90 WPM</option>
          <option value="95">95 WPM</option>
          <option value="100">100 WPM</option>
        </select>
      </div>

      <div id="video-container"></div>

      <div class="timer-container">
        Typing timer: <span id="timer">50:00</span>
        <div class="timer-controls">
          <label><input type="radio" name="duration" value="2400"> 40 min</label>
          <label><input type="radio" name="duration" value="3000" checked> 50 min</label>
          <button id="startPause" class="tmrBtn">Start</button>
          <button id="reset" class="tmrBtn">Reset</button>
        </div>
      </div>

      <div id="paragraphA"></div>
      <textarea class="inputBox" id="paragraphB" spellcheck="false" placeholder="Click Start to begin typing" disabled></textarea>
      <div class="resultText" id="textBoxC" style="display: none;"></div>
      <button onclick="downloadPDF()" class="download-btn">Show Result</button>
    </div>

    <!-- Leaderboard Tab -->
    <div id="leaderboard-tab" class="tab-content">
      <h2>üèÜ Leaderboard</h2>
      <div class="leaderboard-controls">
        <select id="leaderboard-test-select">
          <option value="all">All Tests</option>
        </select>
        <select id="leaderboard-speed-select">
          <option value="all">All Speeds</option>
          <option value="70">70 WPM</option>
          <option value="75">75 WPM</option>
          <option value="80">80 WPM</option>
          <option value="85">85 WPM</option>
          <option value="90">90 WPM</option>
          <option value="95">95 WPM</option>
          <option value="100">100 WPM</option>
        </select>
      </div>
      <div id="leaderboard-content">
        <table>
          <thead>
            <tr>
              <th>Rank</th>
              <th>User</th>
              <th>Test</th>
              <th>Speed</th>
              <th>Accuracy</th>
              <th>WPM</th>
              <th>Date</th>
            </tr>
          </thead>
          <tbody id="leaderboard-entries">
            <tr><td colspan="7" style="text-align: center;">Loading leaderboard...</td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <div class="footer">
    <div>
      Made with <span style="color: red;">&hearts;</span> &middot; Anish &middot; <a href="#">Contact</a>
    </div>
  </div>

  <!-- Extras -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <!-- Firebase Config and App Logic -->
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBjY-pE5jxQJgKqDZrcE7Im66_5r-X_mRA",
      authDomain: "setup-login-page.firebaseapp.com",
      projectId: "setup-login-page",
      storageBucket: "setup-login-page.appspot.com",
      messagingSenderId: "341251531099",
      appId: "1:341251531099:web:f4263621455541ffdc3a7e",
      measurementId: "G-ZXFC7NR9HV"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    document.getElementById("googleSignIn").onclick = () => {
      const provider = new firebase.auth.GoogleAuthProvider();
      auth.signInWithPopup(provider);
    };

    document.getElementById("signOut").onclick = () => {
      auth.signOut();
    };

    auth.onAuthStateChanged((user) => {
      document.getElementById('login-container').style.display = user ? 'none' : 'flex';
      document.getElementById('app-content').style.display = user ? 'block' : 'none';
      document.getElementById('user-info').style.display = user ? 'flex' : 'none';

      if (user) {
        document.getElementById('user-photo').src = user.photoURL || '';
        document.getElementById('user-name').textContent = user.displayName || user.email;
        populateLeaderboardTestSelect();
        loadLeaderboard();
      }
    });

    // Tab Switching
    document.querySelectorAll('.tab-button').forEach(button => {
      button.addEventListener('click', () => {
        document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
        button.classList.add('active');
        document.getElementById(button.dataset.tab + '-tab').classList.add('active');
        if (button.dataset.tab === 'leaderboard') loadLeaderboard();
      });
    });

    // Populate Test List Based on Volume
    const testSelect = document.getElementById('test-select');
    const volumeSelect = document.getElementById('volume-select');
    const volumeRanges = {
      1: [1, 22], 2: [23, 44], 3: [45, 66],
      4: [67, 88], 5: [89, 110]
    };

    volumeSelect.addEventListener('change', function () {
      const [start, end] = volumeRanges[this.value];
      testSelect.innerHTML = '';
      for (let i = start; i <= end; i++) {
        const opt = document.createElement('option');
        opt.value = i;
        opt.textContent = `Test ${i}`;
        testSelect.appendChild(opt);
      }
      testSelect.dispatchEvent(new Event('change'));
    });

    testSelect.addEventListener('change', function () {
      const testNumber = parseInt(this.value);
      const speed = parseInt(document.getElementById('speed-select').value);
      const videoUrl = urlLookup[testNumber]?.[speed];
      const videoContainer = document.getElementById('video-container');
      const paragraphBox = document.getElementById('paragraphA');
      document.getElementById('paragraphB').value = '';
      document.getElementById('paragraphB').disabled = false;

      if (videoUrl) {
        videoContainer.innerHTML = `<iframe src="${videoUrl}" allowfullscreen></iframe>`;
      } else {
        videoContainer.innerHTML = '<p style="color:red">Video not found for this test/speed.</p>';
      }

      const para = textTable[testNumber];
      paragraphBox.textContent = para || 'Text not available.';
    });

    document.getElementById('speed-select').addEventListener('change', () => {
      testSelect.dispatchEvent(new Event('change'));
    });

    // Load first test on start
    volumeSelect.dispatchEvent(new Event('change'));
  </script>
</body>
</html>
